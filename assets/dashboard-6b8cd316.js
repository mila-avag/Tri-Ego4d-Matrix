import{r as o,g as u,s as v,p as K}from"./index-c26fbd09.js";async function V(s){const T=o(s,"users");o(s,"logs"),o(s,"statuses");const A=["Inactive","Tech issues","Recording","Setting up room","Break"];let a="",i=!1,h=new Date,d;const p=document.getElementById("userSelect"),b=document.getElementById("pinInput"),k=document.getElementById("confirmUser"),U=document.getElementById("createUser"),M=document.getElementById("logoutBtn"),E=document.getElementById("userSelection"),B=document.getElementById("dashboardContainer"),O=document.getElementById("userInfo"),g=document.getElementById("statusText"),f=document.getElementById("statusTimer"),w=document.getElementById("statusButtons"),x=document.getElementById("logBody"),S=document.getElementById("errorMessage"),r=t=>{S.textContent=t,S.style.display="block"},c=()=>{S.style.display="none"};function N(){localStorage.setItem("currentUser",a),localStorage.setItem("isAdmin",i)}function H(){localStorage.removeItem("currentUser"),localStorage.removeItem("isAdmin")}function P(){const t=localStorage.getItem("currentUser");return t?(a=t,i=localStorage.getItem("isAdmin")==="true",L(),!0):!1}function L(){E.style.display="none",B.style.display="block",O.textContent=`Logged in as: ${a}`,$(),z()}function F(){clearInterval(d),d=setInterval(()=>{const t=Date.now()-h.getTime(),e=Math.floor(t/1e3),n=Math.floor(e/3600),m=Math.floor(e%3600/60),l=e%60;f.textContent=` (${String(n).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(l).padStart(2,"0")})`},1e3)}async function y(){c(),p.innerHTML='<option value="" disabled selected>— select your name —</option>';try{const t=await u(T);t.exists()&&t.forEach(e=>{const n=document.createElement("option");n.value=e.key,n.textContent=e.key,p.appendChild(n)})}catch{r("Users load failed")}}async function R(){c();const t=prompt("Enter your name:");if(!t)return;const e=prompt("Set a 4-digit PIN or admin code:");if(e!=="robotsrcool"&&!/^[0-9]{4}$/.test(e))return r("PIN must be 4 digits or admin code");try{await v(o(s,`users/${t}`),{pin:e}),await v(o(s,`statuses/${t}`),{currentStatus:"Inactive",updatedAt:new Date().toISOString()}),y()}catch{r("Account creation failed")}}async function j(){c();const t=p.value,e=b.value;if(!t||!e)return r("Select name and enter PIN");if(i=e==="robotsrcool",!i){const n=await u(o(s,`users/${t}`));if(!n.exists()||n.val().pin!==e)return r("Invalid credentials")}a=t,N(),L()}function q(){H(),B.style.display="none",E.style.display="block",y()}async function $(){c();try{const t=await u(o(s,`statuses/${a}`)),e=t.exists()?t.val():{currentStatus:"Inactive",updatedAt:new Date().toISOString()};h=new Date(e.updatedAt),C(e.currentStatus),e.currentStatus!=="Inactive"?F():(f.textContent="",clearInterval(d))}catch{r("Status fetch failed")}}async function z(){c(),x.innerHTML="";try{const t=await u(o(s,"logs"));t.exists()&&t.forEach(e=>{const n=e.val();(i||n.name===a)&&D(n)})}catch{r("Logs load failed")}}async function G(t){if(c(),t==="Inactive"){C("Inactive"),f.textContent="",clearInterval(d);return}if(t===g.textContent)return;const e=g.textContent,n=new Date;try{const m=await u(o(s,"logs"));let l="";if(m.exists()){const I=Object.values(m.val()).filter(J=>J.name===a);I.length&&(l=((n-new Date(I[I.length-1].timestamp))/36e5).toFixed(2))}D({timestamp:n.toISOString(),oldStatus:e,newStatus:t,user:a,timeSpent:l,name:a}),await K(o(s,"logs"),{timestamp:n.toISOString(),name:a,oldStatus:e,newStatus:t,user:a,timeSpent:parseFloat(l)||0}),await v(o(s,`statuses/${a}`),{currentStatus:t,updatedAt:new Date().toISOString()}),$()}catch{r("Update failed")}}function C(t){g.textContent=t,w.innerHTML="",A.forEach(e=>{const n=document.createElement("button");n.className="status-btn",n.dataset.status=e,n.textContent=e,e===t&&(n.classList.add("active"),n.disabled=!0),n.addEventListener("click",()=>G(e)),w.appendChild(n)})}function D(t){const e=document.createElement("tr");e.className="log-row",e.innerHTML=`
      <td data-label="Timestamp">${new Date(t.timestamp).toLocaleString()}</td>
      <td data-label="Old">${t.oldStatus||""}</td>
      <td data-label="New">${t.newStatus||""}</td>
      <td data-label="By">${t.user||""}</td>
      <td data-label="Hours">${t.timeSpent!=null?t.timeSpent:""}</td>
    `,x.appendChild(e)}U.addEventListener("click",R),k.addEventListener("click",j),M.addEventListener("click",q),y(),P()}export{V as startDashboard};
