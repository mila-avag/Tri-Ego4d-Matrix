import{r as o,g as l,s as y,p as Q}from"./index-21f547fb.js";async function W(s){const C=o(s,"users");o(s,"logs"),o(s,"statuses");const A=["Inactive","Tech issues","Recording","Setting up room","Break","Training"];let a="",i=!1,I=new Date,m;const g=document.getElementById("userSelect"),b=document.getElementById("pinInput"),k=document.getElementById("confirmUser"),U=document.getElementById("createUser"),M=document.getElementById("logoutBtn"),v=document.getElementById("userSelection"),h=document.getElementById("dashboardContainer"),O=document.getElementById("userInfo"),E=document.getElementById("statusText"),B=document.getElementById("statusTimer"),w=document.getElementById("statusButtons"),x=document.getElementById("logBody"),p=document.getElementById("errorMessage"),r=t=>{p.textContent=t,p.style.display="block"},c=()=>{p.style.display="none"};function N(){localStorage.setItem("currentUser",a),localStorage.setItem("isAdmin",i)}function H(){localStorage.removeItem("currentUser"),localStorage.removeItem("isAdmin")}function P(){const t=localStorage.getItem("currentUser");return t?(a=t,i=localStorage.getItem("isAdmin")==="true",L(),!0):!1}function L(){v.style.display="none",h.style.display="block",O.textContent=`Logged in as: ${a}`,$(),z()}function F(){clearInterval(m),m=setInterval(()=>{const t=Date.now()-I.getTime(),e=Math.floor(t/1e3),n=Math.floor(e/3600),u=Math.floor(e%3600/60),d=e%60;B.textContent=` (${String(n).padStart(2,"0")}:${String(u).padStart(2,"0")}:${String(d).padStart(2,"0")})`},1e3)}async function f(){c(),g.innerHTML='<option value="" disabled selected>— select your name —</option>';try{const t=await l(C);t.exists()&&t.forEach(e=>{const n=document.createElement("option");n.value=e.key,n.textContent=e.key,g.appendChild(n)})}catch{r("Users load failed")}}async function R(){c();const t=prompt("Enter your name:");if(!t)return;const e=prompt("Set a 4-digit PIN or admin code:");if(e!=="robotsrcool"&&!/^[0-9]{4}$/.test(e))return r("PIN must be 4 digits or admin code");try{await y(o(s,`users/${t}`),{pin:e}),await y(o(s,`statuses/${t}`),{currentStatus:"Inactive",updatedAt:new Date().toISOString()}),f()}catch{r("Account creation failed")}}async function j(){c();const t=g.value,e=b.value;if(!t||!e)return r("Select name and enter PIN");if(i=e==="robotsrcool",!i){const n=await l(o(s,`users/${t}`));if(!n.exists()||n.val().pin!==e)return r("Invalid credentials")}a=t,N(),L()}function q(){H(),h.style.display="none",v.style.display="block",f()}async function $(){c();try{const t=await l(o(s,`statuses/${a}`)),e=t.exists()?t.val():{currentStatus:"Inactive",updatedAt:new Date().toISOString()};I=new Date(e.updatedAt),J(e.currentStatus),e.currentStatus!=="Inactive"?F():(B.textContent="",clearInterval(m))}catch{r("Status fetch failed")}}async function z(){c(),x.innerHTML="";try{const t=await l(o(s,"logs"));t.exists()&&t.forEach(e=>{const n=e.val();(i||n.name===a)&&T(n)})}catch{r("Logs load failed")}}async function G(t){c();const e=E.textContent;if(t===e)return;const n=new Date;try{const u=await l(o(s,"logs"));let d="";if(u.exists()){const S=Object.values(u.val()).filter(K=>K.name===a);S.length&&(d=((n-new Date(S[S.length-1].timestamp))/36e5).toFixed(2))}const D=parseFloat(d)||0;T({timestamp:n.toISOString(),oldStatus:e,newStatus:t,user:a,timeSpent:D,name:a}),await Q(o(s,"logs"),{timestamp:n.toISOString(),name:a,oldStatus:e,newStatus:t,user:a,timeSpent:D}),await y(o(s,`statuses/${a}`),{currentStatus:t,updatedAt:n.toISOString()}),$()}catch{r("Update failed")}}function J(t){E.textContent=t,w.innerHTML="",A.forEach(e=>{const n=document.createElement("button");n.className="status-btn",n.dataset.status=e,n.textContent=e,e===t&&(n.classList.add("active"),n.disabled=!0),n.addEventListener("click",()=>G(e)),w.appendChild(n)})}function T(t){const e=document.createElement("tr");e.className="log-row",e.innerHTML=`
      <td data-label="Timestamp">${new Date(t.timestamp).toLocaleString()}</td>
      <td data-label="Old">${t.oldStatus||""}</td>
      <td data-label="New">${t.newStatus||""}</td>
      <td data-label="By">${t.user||""}</td>
      <td data-label="Hours">${t.timeSpent!=null?t.timeSpent:""}</td>
    `,x.appendChild(e)}U.addEventListener("click",R),k.addEventListener("click",j),M.addEventListener("click",q),f(),P()}export{W as startDashboard};
